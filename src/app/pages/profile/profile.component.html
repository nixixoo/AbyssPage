<div class="profile-container">
  <div class="overlay"></div>

  <app-header></app-header>

  <!-- Show loading state -->
  <div class="loading-state" [class.hidden]="!showLoading">
    <div class="loading-spinner">
      <img src="assets/logo.png" alt="Loading..." class="spinning-logo">
    </div>
  </div>

  <!-- Show login message if not authenticated -->
  <div class="login-message" *ngIf="authChecked && !isAuthenticated">
    <h2>Authentication Required</h2>
    <p>Please log in to view this profile.</p>
    <button class="login-btn" (click)="navigateToLogin()">
      Go to Login
    </button>
  </div>

  <!-- Show main content if authenticated -->
  <ng-container *ngIf="authChecked && isAuthenticated">
    <main [class.loaded]="!isLoading" *ngIf="user">
      <div class="profile-header fade-in">
        <div class="user-info">
          <img
            [src]="user.avatar || 'assets/images/default-avatar.png'"
            alt="Profile picture"
            class="profile-avatar"
          />
          <h1>{{ user.username }}</h1>
        </div>
      </div>

      <div class="content-wrapper fade-in">
        <div class="main-section">
          <button class="request-team-btn" (click)="requestTeam()">
            <i class="fas fa-users"></i>
            Request Abyss Team
          </button>
        </div>

        <div class="social-card">
          <h2>Social Media</h2>
          <div class="social-links">
            <ng-container *ngFor="let platform of socialPlatforms">
              <a
                [href]="getSocialLink(platform.id)"
                target="_blank"
                class="social-link {{ platform.id }}"
                *ngIf="hasSocialLink(platform.id)"
              >
                <i class="{{ platform.icon }}"></i>
                {{ platform.name }}
                <button 
                  *ngIf="isOwnProfile" 
                  class="delete-btn" 
                  (click)="deleteSocialMedia(platform.id); $event.preventDefault()"
                >
                  <i class="fas fa-times"></i>
                </button>
              </a>
            </ng-container>
          </div>

          <!-- Only show add button on own profile -->
          <div *ngIf="isOwnProfile" class="social-actions">
            <button
              *ngIf="!showSocialForm"
              (click)="toggleSocialForm()"
              class="add-social-btn"
            >
              <i class="fas fa-plus"></i> Add Social Media
            </button>

            <!-- Social Media Form -->
            <div class="social-form" [class.show]="showSocialForm">
              <div class="custom-select" [class.open]="isSelectOpen">
                <div class="select-header" (click)="toggleSelect($event)">
                  <span>{{ newSocialMedia.platform ? getPlatformName(newSocialMedia.platform) : 'Select Platform' }}</span>
                  <i class="fas fa-chevron-down" [class.rotate]="isSelectOpen"></i>
                </div>
                <div class="options-container">
                  <div 
                    *ngFor="let platform of socialPlatforms" 
                    class="option"
                    [class.disabled]="isPlatformDisabled(platform.id)"
                    (click)="selectPlatform(platform.id)"
                  >
                    <i [class]="platform.icon"></i>
                    {{ platform.name }}
                  </div>
                </div>
              </div>

              <input
                type="url"
                [(ngModel)]="newSocialMedia.url"
                placeholder="Enter URL"
                class="url-input"
              />

              <div class="form-actions">
                <button
                  (click)="addSocialMedia()"
                  [disabled]="!newSocialMedia.platform || !newSocialMedia.url"
                  class="save-btn"
                >
                  Save
                </button>
                <button (click)="toggleSocialForm()" class="cancel-btn">
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </ng-container>
</div>

<ng-template #loading>
  <div class="loading-container">
    <div class="loading-spinner">
      <img src="assets/logo.png" alt="Loading..." class="spinning-logo">
    </div>
  </div>
</ng-template>

<div class="dropdown-portal" *ngIf="isSelectOpen">
  <div 
    class="options-container"
    [style.top.px]="dropdownPosition?.top"
    [style.left.px]="dropdownPosition?.left"
    [style.width.px]="dropdownPosition?.width"
  >
    <div 
      *ngFor="let platform of socialPlatforms" 
      class="option"
      [class.disabled]="isPlatformDisabled(platform.id)"
      (click)="selectPlatform(platform.id)"
    >
      <i [class]="platform.icon"></i>
      {{ platform.name }}
    </div>
  </div>
</div>
