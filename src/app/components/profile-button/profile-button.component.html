<div class="profile-button-wrapper" *ngIf="isLoggedIn && avatarLoaded" [@slideIn] [class.darkened]="isDarkened">
  <button class="floating-profile-btn" [class.darkened]="isDarkened">
    <img [src]="currentAvatar" alt="Profile" (load)="avatarLoaded = true" style="display: none;">
    <img [src]="currentAvatar" alt="Profile">
  </button>

  <div class="profile-menu" [class.darkened]="isDarkened">
    <div class="menu-item" (click)="navigateToProfile()">
      <i class="fas fa-user"></i>
      Profile
    </div>
    <div class="menu-item" (click)="openAvatarSelector()">
      <i class="fas fa-camera"></i>
      Change Avatar
    </div>
    <div class="menu-item logout" (click)="logout()">
      <i class="fas fa-sign-out-alt"></i>
      Logout
    </div>
  </div>
</div>

<!-- Avatar Selector Modal -->
<div class="avatar-selector" [class.show]="showAvatarSelector">
  <div class="avatar-selector-content">
    <div class="header">
      <h2>Select Your Avatar</h2>
      <button class="close-btn" (click)="closeAvatarSelector()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Add search bar -->
    <div class="search-bar">
      <i class="fas fa-search"></i>
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        placeholder="Search avatars..."
        (input)="onSearch($event)"
      >
    </div>

    <div class="avatars-grid">
      <div class="avatar-option" 
           *ngFor="let avatar of filteredAvatars" 
           [@fadeInOut]
           (click)="selectAvatar(avatar)">
        <img [src]="avatar.url" [alt]="avatar.name">
      </div>
    </div>
  </div>
</div>

<!-- Add a hidden preloader -->
<img *ngIf="isLoggedIn && !avatarLoaded" 
     [src]="currentAvatar" 
     (load)="avatarLoaded = true" 
     style="display: none;"
     alt="Preload profile">
